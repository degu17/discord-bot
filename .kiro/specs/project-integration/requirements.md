# 要件書

## はじめに

2つの異なるDiscord botプロジェクトの統合作業を行います。ルートプロジェクトは完全なモデレーション機能を持つ統合型アーキテクチャ（NextJS・Convex・クラウド連携含む）で、discord-botフォルダは基本的なDiscord.jsのみの軽量構成です。この統合により、重複を排除し、統一されたプロジェクト構造を実現します。

## 要件

### 要件1

**ユーザーストーリー:** 開発者として、重複するdiscord-botフォルダを削除して、プロジェクト構造を統一したい。これにより、メンテナンスの負担を軽減し、混乱を避けることができる。

#### 受け入れ基準

1. WHEN discord-botフォルダが削除された THEN システムはルートのsrcディレクトリを正式版として使用する
2. WHEN 削除が完了した THEN システムは不要なファイルが残っていない状態になる
3. WHEN 削除後 THEN システムは既存の機能に影響を与えない

### 要件2

**ユーザーストーリー:** 開発者として、TypeScript設定ファイルを統一したい。これにより、一貫したビルド環境を維持し、設定の重複を避けることができる。

#### 受け入れ基準

1. WHEN tsconfig.jsonファイルが統一された THEN システムは単一の設定でボット機能とWeb機能の両方をサポートする
2. WHEN 設定が統一された THEN システムはtsconfig.bot.jsonを適切に活用する
3. IF 設定に競合がある THEN システムはルートプロジェクトの設定を優先する

### 要件3

**ユーザーストーリー:** 開発者として、package.jsonのスクリプトを整理したい。これにより、開発・ビルド・デプロイのワークフローを統一し、混乱を避けることができる。

#### 受け入れ基準

1. WHEN package.jsonが統一された THEN システムは重複するスクリプトを削除する
2. WHEN スクリプトが整理された THEN システムは必要な全ての機能（bot、web、convex）をサポートする
3. WHEN 統合が完了した THEN システムは単一のpackage.jsonから全ての操作が可能になる

### 要件4

**ユーザーストーリー:** 開発者として、discord-bot内の既存機能をルートプロジェクトに統合したい。これにより、全ての機能が統一されたアーキテクチャで動作し、機能の損失を防ぐことができる。

#### 受け入れ基準

1. WHEN タスク管理機能が統合された THEN システムはルートのsrcディレクトリ内でタスク管理機能が利用可能になる
2. WHEN ミニゲーム機能が統合された THEN システムはルートのsrcディレクトリ内でミニゲーム機能が利用可能になる
3. WHEN 機能統合が完了した THEN システムは既存の機能仕様を維持する
4. WHEN 統合後 THEN システムは統一されたアーキテクチャで全ての機能が動作する

### 要件5

**ユーザーストーリー:** 開発者として、Railway環境に適した設定管理を実現したい。これにより、.envファイルを使用せずに環境変数を適切に管理し、デプロイメントを円滑に行うことができる。

#### 受け入れ基準

1. WHEN Railway環境設定が適用された THEN システムは.envファイルを作成しない
2. WHEN 環境変数が設定された THEN システムはRailway環境変数を直接参照する
3. WHEN 設定が統合された THEN システムは開発環境とRailway環境の両方で動作する
4. IF 環境変数が不足している THEN システムは適切なエラーメッセージを表示する

### 要件6

**ユーザーストーリー:** 開発者として、統合後の全機能が正常に動作することを確認したい。これにより、統合作業が成功したことを保証し、既存機能の破損を防ぐことができる。

#### 受け入れ基準

1. WHEN 統合が完了した THEN システムは全てのDiscordコマンド（モデレーション、タスク管理、ミニゲーム）が正常に動作する
2. WHEN 機能検証が実行された THEN システムはモデレーション機能が適切に動作する
3. WHEN タスク管理機能が検証された THEN システムはタスクの作成・更新・削除が正常に動作する
4. WHEN ミニゲーム機能が検証された THEN システムはゲーム機能が正常に動作する
5. WHEN 権限設定が確認された THEN システムは適切な権限でDiscord APIにアクセスできる
6. IF 機能に問題がある THEN システムは具体的なエラー情報を提供する

### 要件7

**ユーザーストーリー:** 開発者として、既存のテストケースを保持したい。これにより、統合後も品質保証を継続し、機能の動作を検証できる。

#### 受け入れ基準

1. WHEN 統合が実行された THEN システムは既存のテストケースをTEST.mdファイルとして保持する
2. WHEN テストケースが保存された THEN システムは統合前後の機能比較が可能になる
3. WHEN TEST.mdが作成された THEN システムは将来のテスト実行の参考資料として利用できる
4. WHEN テストドキュメントが整理された THEN システムは機能ごとのテストケースが明確に分類される

### 要件8

**ユーザーストーリー:** 開発者として、プロジェクト構造を最適化したい。これにより、開発効率を向上させ、将来の拡張を容易にすることができる。

#### 受け入れ基準

1. WHEN プロジェクト構造が最適化された THEN システムは論理的で一貫したディレクトリ構造を持つ
2. WHEN 最適化が完了した THEN システムは不要なファイルや設定が存在しない
3. WHEN 構造が整理された THEN システムは新しい機能の追加が容易になる
4. WHEN ドキュメントが更新された THEN システムは統合後の構造を正確に反映する