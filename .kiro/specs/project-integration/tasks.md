# 実装計画

- [ ] 1. プロジェクト現状分析とバックアップ作成
  - 両プロジェクトのファイル差分を詳細分析し、統合対象を特定する
  - 重要ファイルのバックアップを作成し、Git コミットで現状を保存する
  - 依存関係の競合と解決方法を特定する
  - _要件: 1.3, 8.1_

- [ ] 2. TEST.mdファイルの作成
  - 既存機能のテストケースを文書化したTEST.mdファイルを作成する
  - モデレーション、タスク管理、ミニゲーム機能のテストケースを整理する
  - 統合後の検証手順を明文化する
  - _要件: 7.1, 7.2, 7.3, 7.4_

- [ ] 3. 型定義ファイルの統合
- [ ] 3.1 タスク管理型定義の統合
  - discord-bot/src/types/task.ts をルート src/types/task.ts に統合する
  - 型定義の差分を確認し、より完全な定義を採用する
  - NotionConfig インターフェースの統合を行う
  - _要件: 4.1, 4.4_

- [ ] 3.2 ゲーム型定義の統合
  - discord-bot/src/types/game.ts をルート src/types/game.ts に統合する
  - GameState、PlayerStats等の型定義を統合する
  - ゲーム設定関連の型を統合する
  - _要件: 4.2, 4.4_

- [ ] 3.3 共通型定義の統合
  - discord-bot/src/types/discord.ts をルート src/types/ に統合する
  - src/types/index.ts で全ての型をエクスポートするよう統合する
  - 型定義の重複を解消し、統一されたインターフェースを提供する
  - _要件: 4.4, 2.2_

- [ ] 4. サービス層の統合
- [ ] 4.1 タスク管理サービスの統合
  - discord-bot/src/services/taskService.ts をルート src/services/ に統合する
  - discord-bot/src/services/notionClient.ts をルート src/services/ に統合する
  - Notion API連携機能を保持し、統合されたアーキテクチャで動作させる
  - _要件: 4.1, 4.3_

- [ ] 4.2 ゲーム管理サービスの統合
  - discord-bot/src/services/gameManager.ts をルート src/services/ に統合する
  - ゲーム状態管理機能を統合し、既存実装との差分を解決する
  - ゲーム統計機能を保持する
  - _要件: 4.2, 4.3_

- [ ] 4.3 コマンド登録サービスの統合
  - discord-bot/src/services/commandRegistry.ts をルート src/services/ に統合する
  - 既存のコマンド登録機能との統合を行う
  - 全てのコマンド（モデレーション、タスク、ゲーム）が登録されることを確認する
  - _要件: 4.4, 6.1_

- [ ] 5. ユーティリティ機能の統合
- [ ] 5.1 ゲームロジックの統合
  - discord-bot/src/utils/gameLogic.ts をルート src/utils/ に統合する
  - Hit&Blow ゲームのロジックを保持し、統合する
  - 既存実装との差分を確認し、より完全な実装を採用する
  - _要件: 4.2, 4.3_

- [ ] 5.2 バリデーション機能の統合
  - discord-bot/src/utils/validation.ts をルート src/utils/ に統合する
  - 入力値検証機能を統合し、全ての機能で共通利用できるようにする
  - 既存のバリデーション機能との重複を解消する
  - _要件: 4.4, 8.2_

- [ ] 5.3 権限チェック機能の統合
  - discord-bot/src/utils/permissionChecker.ts をルート src/utils/ に統合する
  - Discord権限チェック機能を統合し、統一された権限管理を実現する
  - 既存の権限チェック機能との統合を行う
  - _要件: 4.4, 6.5_

- [ ] 6. Discord コマンドの統合
- [ ] 6.1 タスク管理コマンドの統合
  - discord-bot/src/commands/task.ts をルート src/commands/task.ts に統合する
  - タスク作成、更新、削除、一覧表示機能を統合する
  - Notion API連携機能を保持する
  - _要件: 4.1, 4.3, 6.1_

- [ ] 6.2 ミニゲームコマンドの統合
  - discord-bot/src/commands/hitblow.ts をルート src/commands/hitblow.ts に統合する
  - Hit&Blow ゲーム機能を統合し、既存実装との差分を解決する
  - ゲーム統計機能を保持する
  - _要件: 4.2, 4.3, 6.1_

- [ ] 6.3 コマンド登録スクリプトの統合
  - discord-bot/src/scripts/registerCommands.ts をルート src/scripts/ に統合する
  - 全てのコマンド（モデレーション、タスク、ゲーム）の登録を統合する
  - コマンド登録プロセスを統一する
  - _要件: 6.1, 6.5_

- [ ] 7. 設定ファイルの統合
- [ ] 7.1 ゲーム設定の統合
  - discord-bot/src/config/gameSettings.json をルート src/config/ に統合する
  - ゲーム設定項目を統合し、既存設定との差分を解決する
  - 統一された設定管理を実現する
  - _要件: 4.2, 8.2_

- [ ] 7.2 モデレーション設定の統合
  - discord-bot/src/config/moderationRules.json とルート src/config/moderationRules.json を統合する
  - より完全なモデレーション設定を採用する
  - 設定項目の整合性を確認する
  - _要件: 6.2, 8.2_

- [ ] 8. package.json とビルド設定の統合
- [ ] 8.1 依存関係の統合
  - discord-bot/package.json の依存関係をルート package.json に統合する
  - 重複する依存関係を解消し、バージョン競合を解決する
  - 不要な依存関係を削除する
  - _要件: 3.1, 3.2, 8.2_

- [ ] 8.2 スクリプトの整理
  - package.json のスクリプトを整理し、重複を削除する
  - bot、web、convex の全機能をサポートするスクリプトを維持する
  - 開発・ビルド・デプロイのワークフローを統一する
  - _要件: 3.2, 3.3_

- [ ] 8.3 TypeScript設定の統一
  - tsconfig.json と tsconfig.bot.json の設定を確認し、統合に適した設定にする
  - ビルドエラーを解消し、全ての機能が正常にコンパイルされることを確認する
  - 型チェックの整合性を確認する
  - _要件: 2.1, 2.2, 2.3_

- [ ] 9. Railway環境対応の実装
- [ ] 9.1 環境変数設定の実装
  - .envファイルを作成せず、Railway環境変数を直接参照するコードを実装する
  - 開発環境とRailway環境の両方で動作する環境変数管理を実装する
  - 環境変数不足時の適切なエラーハンドリングを実装する
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [ ] 9.2 デプロイメント設定の確認
  - railway.json の設定を確認し、統合後のプロジェクトに適した設定にする
  - ビルドコマンドと起動コマンドが正しく設定されていることを確認する
  - ヘルスチェック機能が正常に動作することを確認する
  - _要件: 5.3_

- [ ] 10. discord-botフォルダの削除
  - 全ての機能統合が完了した後、discord-botフォルダを完全に削除する
  - 削除前に統合漏れがないことを最終確認する
  - 不要なファイルが残っていないことを確認する
  - _要件: 1.1, 1.2, 8.2_

- [ ] 11. 統合後の機能検証
- [ ] 11.1 モデレーション機能の検証
  - 警告、削除、タイムアウト機能が正常に動作することを確認する
  - モデレーションログが正しく記録されることを確認する
  - 設定ファイルの読み込みが正常に動作することを確認する
  - _要件: 6.1, 6.2_

- [ ] 11.2 タスク管理機能の検証
  - タスクの作成、更新、削除、一覧表示が正常に動作することを確認する
  - Notion API連携が正常に動作することを確認する
  - タスク統計機能が正常に動作することを確認する
  - _要件: 6.1, 6.3_

- [ ] 11.3 ミニゲーム機能の検証
  - Hit&Blow ゲームの開始、参加、予想入力が正常に動作することを確認する
  - ゲーム統計の記録と表示が正常に動作することを確認する
  - ゲーム設定の読み込みが正常に動作することを確認する
  - _要件: 6.1, 6.4_

- [ ] 11.4 権限とAPI接続の検証
  - Discord API への接続が正常に動作することを確認する
  - 各コマンドの権限設定が適切に動作することを確認する
  - エラーハンドリングが適切に動作することを確認する
  - _要件: 6.5, 6.6_

- [ ] 12. ドキュメントの更新
- [ ] 12.1 README.mdの更新
  - 統合後のプロジェクト構造を反映したREADME.mdを更新する
  - セットアップ手順、使用方法、機能説明を更新する
  - Railway環境での設定方法を記載する
  - _要件: 8.4_

- [ ] 12.2 TEST.mdの最終更新
  - 統合後の機能に合わせてTEST.mdを最終更新する
  - 実際の検証結果を記録する
  - 将来のテスト実行手順を明文化する
  - _要件: 7.3, 7.4_

- [ ] 13. 最終検証とクリーンアップ
  - 全ての機能が統合され、正常に動作することを最終確認する
  - 不要なファイル、設定、依存関係が残っていないことを確認する
  - プロジェクト構造が論理的で一貫していることを確認する
  - _要件: 8.1, 8.2, 8.3_