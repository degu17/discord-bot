# Discord Bot 統合テストケース

## テスト実行概要

このドキュメントは、Discord Botプロジェクトの統合前後の機能テストケースを記録します。

## 1. モデレーション機能テスト

### 1.1 警告機能テスト
- **テストケース**: レベル1検出語「ばか」「あほ」「うざい」を含むメッセージの送信
- **期待結果**: 警告メッセージの表示、ログへの記録
- **検証項目**:
  - [ ] 警告メッセージが適切に表示される
  - [ ] モデレーションログに記録される
  - [ ] ユーザーにDM通知が送信される（設定による）

### 1.2 メッセージ削除テスト
- **テストケース**: レベル2検出語「死ね」「殺す」「消えろ」を含むメッセージの送信
- **期待結果**: メッセージの自動削除、削除通知の表示
- **検証項目**:
  - [ ] 問題のあるメッセージが削除される
  - [ ] 削除理由の通知が表示される
  - [ ] モデレーションログに削除記録が残る

### 1.3 タイムアウト機能テスト
- **テストケース**: レベル3検出語「クソ野郎」「ゴミ人間」を含むメッセージの送信
- **期待結果**: ユーザーのタイムアウト実行、制限通知の表示
- **検証項目**:
  - [ ] ユーザーが10分間タイムアウトされる
  - [ ] タイムアウト通知が表示される
  - [ ] タイムアウト解除時に通知される

### 1.4 権限チェックテスト
- **テストコマンド**: `/modtest permissions`
- **期待結果**: Bot権限の状況表示
- **検証項目**:
  - [ ] メッセージ管理権限の確認
  - [ ] タイムアウト権限の確認
  - [ ] チャンネル権限の確認

## 2. タスク管理機能テスト

### 2.1 タスク作成テスト
- **テストコマンド**: `/task create title:"テストタスク" priority:high deadline:"2024-12-31"`
- **期待結果**: タスクの作成、Notion連携（設定による）
- **検証項目**:
  - [ ] タスクが正常に作成される
  - [ ] 優先度が正しく設定される
  - [ ] 期限が正しく設定される
  - [ ] Notion APIに同期される（設定による）

### 2.2 タスク更新テスト
- **テストコマンド**: 
  - `/task update title task_id:"1" new_title:"更新後タスク"`
  - `/task update priority task_id:"1" new_priority:low`
  - `/task update deadline task_id:"1" new_deadline:"2025-01-15"`
- **期待結果**: タスク情報の更新
- **検証項目**:
  - [ ] タイトルが正しく更新される
  - [ ] 優先度が正しく更新される
  - [ ] 期限が正しく更新される
  - [ ] Notion側も同期される

### 2.3 タスク削除テスト
- **テストコマンド**: `/task delete task_id:"1"`
- **期待結果**: タスクの削除確認、実行
- **検証項目**:
  - [ ] 削除確認メッセージが表示される
  - [ ] タスクが正常に削除される
  - [ ] Notion側からも削除される

### 2.4 タスク確認テスト
- **テストコマンド**: `/task confirm task_id:"1"`
- **期待結果**: タスクの完了マーク
- **検証項目**:
  - [ ] タスクが完了状態になる
  - [ ] 完了通知が表示される
  - [ ] 統計情報が更新される

## 3. ミニゲーム機能（Hit&Blow）テスト

### 3.1 ゲーム開始テスト
- **テストコマンド**: `/hitblow start`
- **期待結果**: ゲームの開始、参加者募集の表示
- **検証項目**:
  - [ ] ゲーム開始メッセージが表示される
  - [ ] 参加ボタンが正常に動作する
  - [ ] 制限時間のカウントダウンが開始される

### 3.2 ゲーム参加テスト
- **テストコマンド**: `/hitblow join` または参加ボタンクリック
- **期待結果**: ゲームへの参加登録
- **検証項目**:
  - [ ] 参加者リストに追加される
  - [ ] 参加確認メッセージが表示される
  - [ ] 重複参加がブロックされる

### 3.3 予想送信テスト
- **テストコマンド**: `/hitblow send guess:"1234"`
- **期待結果**: 予想の処理、結果の表示
- **検証項目**:
  - [ ] Hit/Blowの判定が正確である
  - [ ] 結果が適切な形式で表示される
  - [ ] 正解時にゲーム終了する

### 3.4 履歴表示テスト
- **テストコマンド**: `/hitblow history`
- **期待結果**: ゲーム統計の表示
- **検証項目**:
  - [ ] 個人統計が正しく表示される
  - [ ] ゲーム履歴が記録されている
  - [ ] 勝率等の計算が正確である

## 4. 統合機能テスト

### 4.1 コマンド登録テスト
- **実行方法**: Bot起動時の自動登録
- **期待結果**: 全コマンドのDiscordサーバー登録
- **検証項目**:
  - [ ] `/hitblow` コマンドが利用可能
  - [ ] `/task` コマンドが利用可能  
  - [ ] `/modtest` コマンドが利用可能
  - [ ] サブコマンドが正しく表示される

### 4.2 環境変数テスト
- **確認項目**: Railway環境変数の読み込み
- **検証項目**:
  - [ ] DISCORD_TOKEN が正しく読み込まれる
  - [ ] DISCORD_CLIENT_ID が設定されている
  - [ ] NOTION_TOKEN が設定されている（必要に応じて）
  - [ ] NOTION_TASK_DB_ID が設定されている（必要に応じて）

### 4.3 エラーハンドリングテスト
- **テスト方法**: 各機能で意図的にエラーを発生させる
- **検証項目**:
  - [ ] エラーメッセージが適切に表示される
  - [ ] Bot自体がクラッシュしない
  - [ ] エラーログが記録される
  - [ ] ユーザーに分かりやすい説明が提供される

## 5. 統合後の機能互換性テスト

### 5.1 同時機能テスト
- **テスト内容**: 複数機能の同時実行
- **検証項目**:
  - [ ] モデレーション実行中にゲーム開始可能
  - [ ] タスク操作中にモデレーション動作
  - [ ] 複数ユーザーでの同時コマンド実行

### 5.2 設定ファイル整合性テスト
- **確認対象**: `src/config/` 内の設定ファイル
- **検証項目**:
  - [ ] `moderationRules.json` が正しく読み込まれる
  - [ ] `gameSettings.json` が正しく読み込まれる
  - [ ] デフォルト値が適用される

## 6. パフォーマンステスト

### 6.1 起動時間テスト
- **測定項目**: Bot起動からready状態までの時間
- **期待値**: 10秒以内
- **検証項目**:
  - [ ] 初期化処理が10秒以内に完了
  - [ ] 全サービスが正常に開始される
  - [ ] エラーが発生しない

### 6.2 メモリ使用量テスト
- **測定項目**: 起動後のメモリ使用量
- **検証項目**:
  - [ ] メモリリークが発生しない
  - [ ] 長時間稼働でメモリ使用量が安定
  - [ ] Railway環境制限内で動作

## 統合前後の比較

### 統合前（discord-botフォルダ使用時）
- 軽量なアーキテクチャ
- 基本的なエラーハンドリング
- シンプルな設定構成

### 統合後（ルートプロジェクト使用）
- 統合されたアーキテクチャ
- 包括的なモデレーション機能
- より充実した設定とエラーハンドリング

## テスト実行チェックリスト

統合作業完了後、以下の順序でテストを実行：

1. [ ] 環境変数設定確認
2. [ ] Bot起動テスト
3. [ ] コマンド登録確認
4. [ ] モデレーション機能テスト（全レベル）
5. [ ] タスク管理機能テスト（CRUD操作）
6. [ ] ミニゲーム機能テスト（全フロー）
7. [ ] 統合機能テスト
8. [ ] エラーハンドリングテスト
9. [ ] パフォーマンステスト

## 注意事項

- テスト実行前に開発環境でのテストを推奨
- 本番環境では段階的なテストを実施
- 各テストケースで問題が発生した場合は統合作業を一時停止し、問題を解決してから継続
- Notion API関連のテストは適切なトークンと設定が必要